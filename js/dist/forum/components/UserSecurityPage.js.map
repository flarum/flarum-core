{"version":3,"file":"forum/components/UserSecurityPage.js","mappings":"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","sources":["webpack://@flarum/core/./src/forum/components/AccessTokensList.tsx","webpack://@flarum/core/./src/forum/components/NewAccessTokenModal.tsx","webpack://@flarum/core/./src/forum/states/UserSecurityPageState.ts","webpack://@flarum/core/./src/forum/components/UserSecurityPage.tsx"],"sourcesContent":["import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport app from '../app';\nimport Component from '../../common/Component';\nimport Button from '../../common/components/Button';\nimport IPAddress from '../../common/components/IPAddress';\nimport humanTime from '../../common/helpers/humanTime';\nimport ItemList from '../../common/utils/ItemList';\nimport LabelValue from '../../common/components/LabelValue';\nimport extractText from '../../common/utils/extractText';\nimport classList from '../../common/utils/classList';\nimport Tooltip from '../../common/components/Tooltip';\nimport Icon from '../../common/components/Icon';\nexport default class AccessTokensList extends Component {\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"loading\", {});\n    _defineProperty(this, \"showingTokens\", {});\n  }\n  view(vnode) {\n    return m(\"div\", {\n      className: \"AccessTokensList\"\n    }, this.attrs.tokens.length ? this.attrs.tokens.map(this.tokenView.bind(this)) : m(\"div\", {\n      className: \"AccessTokensList--empty\"\n    }, app.translator.trans('core.forum.security.empty_text')));\n  }\n  tokenView(token) {\n    return m(\"div\", {\n      className: classList('AccessTokensList-item', {\n        'AccessTokensList-item--active': token.isCurrent()\n      }),\n      key: token.id()\n    }, this.tokenViewItems(token).toArray());\n  }\n  tokenViewItems(token) {\n    const items = new ItemList();\n    items.add('icon', m(\"div\", {\n      className: \"AccessTokensList-item-icon\"\n    }, m(Icon, {\n      name: this.attrs.icon || 'fas fa-key'\n    })), 50);\n    items.add('info', m(\"div\", {\n      className: \"AccessTokensList-item-info\"\n    }, this.tokenInfoItems(token).toArray()), 40);\n    items.add('actions', m(\"div\", {\n      className: \"AccessTokensList-item-actions\"\n    }, this.tokenActionItems(token).toArray()), 30);\n    return items;\n  }\n  tokenInfoItems(token) {\n    const items = new ItemList();\n    if (this.attrs.type === 'session') {\n      items.add('title', m(\"div\", {\n        className: \"AccessTokensList-item-title\"\n      }, m(\"span\", {\n        className: \"AccessTokensList-item-title-main\"\n      }, token.device()), token.isCurrent() && [' â€” ', m(\"span\", {\n        className: \"AccessTokensList-item-title-sub\"\n      }, app.translator.trans('core.forum.security.current_active_session'))]));\n    } else {\n      items.add('title', m(\"div\", {\n        className: \"AccessTokensList-item-title\"\n      }, m(\"span\", {\n        className: \"AccessTokensList-item-title-main\"\n      }, this.generateTokenTitle(token))));\n    }\n    items.add('createdAt', m(\"div\", {\n      className: \"AccessTokensList-item-createdAt\"\n    }, m(LabelValue, {\n      label: app.translator.trans('core.forum.security.created'),\n      value: humanTime(token.createdAt())\n    })));\n    items.add('lastActivityAt', m(\"div\", {\n      className: \"AccessTokensList-item-lastActivityAt\"\n    }, m(LabelValue, {\n      label: app.translator.trans('core.forum.security.last_activity'),\n      value: token.lastActivityAt() ? m('[', null, humanTime(token.lastActivityAt()), token.lastIpAddress() && m(\"span\", null, ' ', \"\\u2014 \", m(IPAddress, {\n        ip: token.lastIpAddress()\n      })), this.attrs.type === 'developer_token' && token.device() && m('[', null, ' ', \"\\u2014 \", m(\"span\", {\n        className: \"AccessTokensList-item-title-sub\"\n      }, token.device()))) : app.translator.trans('core.forum.security.never')\n    })));\n    return items;\n  }\n  tokenActionItems(token) {\n    const items = new ItemList();\n    const deleteKey = {\n      session: 'terminate_session',\n      developer_token: 'revoke_access_token'\n    }[this.attrs.type];\n    if (this.attrs.type === 'developer_token') {\n      const isHidden = !this.showingTokens[token.id()];\n      const displayKey = isHidden ? 'show_access_token' : 'hide_access_token';\n      items.add('toggleDisplay', m(Button, {\n        className: \"Button Button--inverted\",\n        icon: isHidden ? 'fas fa-eye' : 'fas fa-eye-slash',\n        onclick: () => {\n          this.showingTokens[token.id()] = isHidden;\n          m.redraw();\n        }\n      }, app.translator.trans(`core.forum.security.${displayKey}`)));\n    }\n    let revokeButton = m(Button, {\n      className: \"Button Button--danger\",\n      disabled: token.isCurrent(),\n      loading: !!this.loading[token.id()],\n      onclick: () => this.revoke(token)\n    }, app.translator.trans(`core.forum.security.${deleteKey}`));\n    if (token.isCurrent()) {\n      revokeButton = m(Tooltip, {\n        text: app.translator.trans('core.forum.security.cannot_terminate_current_session')\n      }, m(\"div\", {\n        tabindex: \"0\"\n      }, revokeButton));\n    }\n    items.add('revoke', revokeButton);\n    return items;\n  }\n  async revoke(token) {\n    if (!confirm(extractText(app.translator.trans('core.forum.security.revoke_access_token_confirmation')))) return;\n    this.loading[token.id()] = true;\n    await token.delete();\n    this.loading[token.id()] = false;\n    this.attrs.ondelete?.(token);\n    const key = this.attrs.type === 'session' ? 'session_terminated' : 'token_revoked';\n    app.alerts.show({\n      type: 'success'\n    }, app.translator.trans(`core.forum.security.${key}`, {\n      count: 1\n    }));\n    m.redraw();\n  }\n  generateTokenTitle(token) {\n    const name = token.title() || app.translator.trans('core.forum.security.token_title_placeholder');\n    const value = this.tokenValueDisplay(token);\n    return app.translator.trans('core.forum.security.token_item_title', {\n      title: name,\n      token: value\n    });\n  }\n  tokenValueDisplay(token) {\n    const obfuscatedName = Array(12).fill('*').join('');\n    const value = this.showingTokens[token.id()] ? token.token() : obfuscatedName;\n    return m(\"code\", {\n      className: \"AccessTokensList-item-token\"\n    }, value);\n  }\n}\nflarum.reg.add('core', 'forum/components/AccessTokensList', AccessTokensList);","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport app from '../app';\nimport FormModal from '../../common/components/FormModal';\nimport Button from '../../common/components/Button';\nimport Stream from '../../common/utils/Stream';\nimport Form from '../../common/components/Form';\nexport default class NewAccessTokenModal extends FormModal {\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"titleInput\", Stream(''));\n  }\n  className() {\n    return 'Modal--small NewAccessTokenModal';\n  }\n  title() {\n    return app.translator.trans('core.forum.security.new_access_token_modal.title');\n  }\n  content() {\n    const titleLabel = app.translator.trans('core.forum.security.new_access_token_modal.title_placeholder');\n    return m(\"div\", {\n      className: \"Modal-body\"\n    }, m(Form, {\n      className: \"Form--centered\"\n    }, m(\"div\", {\n      className: \"Form-group\"\n    }, m(\"input\", {\n      type: \"text\",\n      className: \"FormControl\",\n      bidi: this.titleInput,\n      placeholder: titleLabel,\n      \"aria-label\": titleLabel\n    })), m(\"div\", {\n      className: \"Form-group Form-controls\"\n    }, m(Button, {\n      className: \"Button Button--primary Button--block\",\n      type: \"submit\",\n      loading: this.loading\n    }, app.translator.trans('core.forum.security.new_access_token_modal.submit_button')))));\n  }\n  submitData() {\n    return {\n      title: this.titleInput()\n    };\n  }\n  onsubmit(e) {\n    super.onsubmit(e);\n    e.preventDefault();\n    this.loading = true;\n    app.store.createRecord('access-tokens').save(this.submitData()).then(token => {\n      this.attrs.onsuccess(token);\n      app.modal.close();\n    }).finally(this.loaded.bind(this));\n  }\n}\nflarum.reg.add('core', 'forum/components/NewAccessTokenModal', NewAccessTokenModal);","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nexport default class UserSecurityPageState {\n  constructor() {\n    _defineProperty(this, \"tokens\", null);\n    _defineProperty(this, \"loadingTerminateSessions\", false);\n    _defineProperty(this, \"loadingGlobalLogout\", false);\n  }\n  hasLoadedTokens() {\n    return this.tokens !== null;\n  }\n  getTokens() {\n    return this.tokens;\n  }\n  setTokens(tokens) {\n    this.tokens = tokens;\n  }\n  pushToken(token) {\n    this.tokens?.push(token);\n  }\n  removeToken(token) {\n    this.tokens = this.tokens.filter(t => t !== token);\n  }\n  getSessionTokens() {\n    return this.tokens?.filter(token => token.isSessionToken()).sort((a, b) => b.isCurrent() ? 1 : -1) || [];\n  }\n  getDeveloperTokens() {\n    return this.tokens?.filter(token => !token.isSessionToken()) || null;\n  }\n\n  /**\n   * Look up session tokens other than the current one.\n   */\n  getOtherSessionTokens() {\n    return this.tokens?.filter(token => token.isSessionToken() && !token.isCurrent()) || [];\n  }\n  hasOtherActiveSessions() {\n    return (this.getOtherSessionTokens() || []).length > 0;\n  }\n  removeOtherSessionTokens() {\n    this.tokens = this.tokens.filter(token => !token.isSessionToken() || token.isCurrent());\n  }\n}\nflarum.reg.add('core', 'forum/states/UserSecurityPageState', UserSecurityPageState);","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport app from '../../forum/app';\nimport UserPage from './UserPage';\nimport ItemList from '../../common/utils/ItemList';\nimport FieldSet from '../../common/components/FieldSet';\nimport listItems from '../../common/helpers/listItems';\nimport extractText from '../../common/utils/extractText';\nimport AccessTokensList from './AccessTokensList';\nimport LoadingIndicator from '../../common/components/LoadingIndicator';\nimport Button from '../../common/components/Button';\nimport NewAccessTokenModal from './NewAccessTokenModal';\nimport Tooltip from '../../common/components/Tooltip';\nimport UserSecurityPageState from '../states/UserSecurityPageState';\n\n/**\n * The `UserSecurityPage` component displays the user's security control panel, in\n * the context of their user profile.\n */\nexport default class UserSecurityPage extends UserPage {\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"state\", new UserSecurityPageState());\n  }\n  oninit(vnode) {\n    super.oninit(vnode);\n    const routeUsername = m.route.param('username');\n    if (routeUsername !== app.session.user?.slug() && !app.forum.attribute('canModerateAccessTokens')) {\n      m.route.set('/');\n    }\n    this.loadUser(routeUsername);\n    app.setTitle(extractText(app.translator.trans('core.forum.security.title')));\n    this.loadTokens();\n  }\n  content() {\n    return m(\"div\", {\n      className: \"UserSecurityPage\"\n    }, m(\"ul\", null, listItems(this.settingsItems().toArray())));\n  }\n\n  /**\n   * Build an item list for the user's settings controls.\n   */\n  settingsItems() {\n    const items = new ItemList();\n    if (app.forum.attribute('canCreateAccessToken') || app.forum.attribute('canModerateAccessTokens') || this.state.hasLoadedTokens() && this.state.getDeveloperTokens()?.length) {\n      items.add('developerTokens', m(FieldSet, {\n        className: \"UserSecurityPage-developerTokens\",\n        label: app.translator.trans(`core.forum.security.developer_tokens_heading`)\n      }, this.developerTokensItems().toArray()));\n    } else if (!this.state.hasLoadedTokens()) {\n      items.add('developerTokens', m(LoadingIndicator, null));\n    }\n    items.add('sessions', m(FieldSet, {\n      className: \"UserSecurityPage-sessions\",\n      label: app.translator.trans(`core.forum.security.sessions_heading`)\n    }, this.sessionsItems().toArray()));\n    if (this.user.id() === app.session.user.id()) {\n      items.add('globalLogout', m(FieldSet, {\n        className: \"FieldSet--col UserSecurityPage-globalLogout\",\n        label: app.translator.trans('core.forum.security.global_logout.heading'),\n        description: app.translator.trans('core.forum.security.global_logout.help_text')\n      }, m(Button, {\n        className: \"Button\",\n        icon: \"fas fa-sign-out-alt\",\n        onclick: this.globalLogout.bind(this),\n        loading: this.state.loadingGlobalLogout,\n        disabled: this.state.loadingTerminateSessions\n      }, app.translator.trans('core.forum.security.global_logout.log_out_button'))));\n    }\n    return items;\n  }\n\n  /**\n   * Build an item list for the user's access accessToken settings.\n   */\n  developerTokensItems() {\n    const items = new ItemList();\n    items.add('accessTokenList', !this.state.hasLoadedTokens() ? m(LoadingIndicator, null) : m(AccessTokensList, {\n      type: \"developer_token\",\n      ondelete: token => {\n        this.state.removeToken(token);\n        m.redraw();\n      },\n      tokens: this.state.getDeveloperTokens(),\n      icon: \"fas fa-key\",\n      hideTokens: false\n    }));\n    if (this.user.id() === app.session.user.id()) {\n      items.add('newAccessToken', m(\"div\", {\n        className: \"UserSecurityPage-controls\"\n      }, m(Button, {\n        className: \"Button\",\n        disabled: !app.forum.attribute('canCreateAccessToken'),\n        onclick: () => app.modal.show(NewAccessTokenModal, {\n          onsuccess: token => {\n            this.state.pushToken(token);\n            m.redraw();\n          }\n        })\n      }, app.translator.trans('core.forum.security.new_access_token_button'))));\n    }\n    return items;\n  }\n\n  /**\n   * Build an item list for the user's access accessToken settings.\n   */\n  sessionsItems() {\n    const items = new ItemList();\n    items.add('sessionsList', !this.state.hasLoadedTokens() ? m(LoadingIndicator, null) : m(AccessTokensList, {\n      type: \"session\",\n      ondelete: token => {\n        this.state.removeToken(token);\n        m.redraw();\n      },\n      tokens: this.state.getSessionTokens(),\n      icon: \"fas fa-laptop\",\n      hideTokens: true\n    }));\n    if (this.user.id() === app.session.user.id()) {\n      const isDisabled = !this.state.hasOtherActiveSessions();\n      let terminateAllOthersButton = m(Button, {\n        className: \"Button\",\n        onclick: this.terminateAllOtherSessions.bind(this),\n        loading: this.state.loadingTerminateSessions,\n        disabled: this.state.loadingGlobalLogout || isDisabled\n      }, app.translator.trans('core.forum.security.terminate_all_other_sessions'));\n      if (isDisabled) {\n        terminateAllOthersButton = m(Tooltip, {\n          text: app.translator.trans('core.forum.security.cannot_terminate_current_session')\n        }, m(\"span\", {\n          tabindex: \"0\"\n        }, terminateAllOthersButton));\n      }\n      items.add('terminateAllOtherSessions', m(\"div\", {\n        className: \"UserSecurityPage-controls\"\n      }, terminateAllOthersButton));\n    }\n    return items;\n  }\n  loadTokens() {\n    const userId = this.user.id();\n\n    // Load session tokens\n    const sessionsPromise = app.store.find('access-tokens', {\n      filter: {\n        user: userId,\n        '-type': 'developer'\n      }\n    }).then(tokens => {\n      return tokens;\n    });\n\n    // Load developer tokens\n    const developerPromise = app.store.find('access-tokens', {\n      filter: {\n        user: userId,\n        type: 'developer'\n      }\n    }).then(tokens => {\n      return tokens;\n    });\n    return Promise.all([sessionsPromise, developerPromise]).then(_ref => {\n      let [sessions, developerTokens] = _ref;\n      // Combine both arrays\n      const allTokens = [...sessions, ...developerTokens];\n      this.state.setTokens(allTokens);\n      m.redraw();\n    });\n  }\n  terminateAllOtherSessions() {\n    if (!confirm(extractText(app.translator.trans('core.forum.security.terminate_all_other_sessions_confirmation')))) return;\n    this.state.loadingTerminateSessions = true;\n    return app.request({\n      method: 'DELETE',\n      url: app.forum.attribute('apiUrl') + '/sessions'\n    }).then(() => {\n      // Count terminated sessions first.\n      const count = this.state.getOtherSessionTokens().length;\n      this.state.removeOtherSessionTokens();\n      app.alerts.show({\n        type: 'success'\n      }, app.translator.trans('core.forum.security.session_terminated', {\n        count\n      }));\n    }).catch(() => {\n      app.alerts.show({\n        type: 'error'\n      }, app.translator.trans('core.forum.security.session_termination_failed'));\n    }).finally(() => {\n      this.state.loadingTerminateSessions = false;\n      m.redraw();\n    });\n  }\n  globalLogout() {\n    this.state.loadingGlobalLogout = true;\n    return app.request({\n      method: 'POST',\n      url: app.forum.attribute('baseUrl') + '/global-logout'\n    }).then(() => window.location.reload()).finally(() => {\n      this.state.loadingGlobalLogout = false;\n      m.redraw();\n    });\n  }\n}\nflarum.reg.add('core', 'forum/components/UserSecurityPage', UserSecurityPage);"],"names":["AccessTokensList","Component","constructor","super","arguments","this","view","vnode","m","className","attrs","tokens","length","map","tokenView","bind","app","translator","trans","token","classList","isCurrent","key","id","tokenViewItems","toArray","items","ItemList","add","Icon","name","icon","tokenInfoItems","tokenActionItems","type","device","generateTokenTitle","LabelValue","label","value","humanTime","createdAt","lastActivityAt","lastIpAddress","IPAddress","ip","deleteKey","session","developer_token","isHidden","showingTokens","displayKey","Button","onclick","redraw","revokeButton","disabled","loading","revoke","Tooltip","text","tabindex","confirm","extractText","delete","ondelete","alerts","show","count","title","tokenValueDisplay","obfuscatedName","Array","fill","join","flarum","reg","NewAccessTokenModal","FormModal","Stream","content","titleLabel","Form","bidi","titleInput","placeholder","submitData","onsubmit","e","preventDefault","store","createRecord","save","then","onsuccess","modal","close","finally","loaded","UserSecurityPageState","hasLoadedTokens","getTokens","setTokens","pushToken","push","removeToken","filter","t","getSessionTokens","isSessionToken","sort","a","b","getDeveloperTokens","getOtherSessionTokens","hasOtherActiveSessions","removeOtherSessionTokens","UserSecurityPage","UserPage","oninit","routeUsername","route","param","user","slug","forum","attribute","set","loadUser","setTitle","loadTokens","listItems","settingsItems","state","FieldSet","developerTokensItems","LoadingIndicator","sessionsItems","description","globalLogout","loadingGlobalLogout","loadingTerminateSessions","hideTokens","isDisabled","terminateAllOthersButton","terminateAllOtherSessions","userId","sessionsPromise","find","developerPromise","Promise","all","_ref","sessions","developerTokens","allTokens","request","method","url","catch","window","location","reload"],"sourceRoot":""}